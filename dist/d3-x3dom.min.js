(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory(require("d3"),require("d3-shape"),require("d3-array")):typeof define==="function"&&define.amd?define(["d3","d3-shape","d3-array"],factory):(global=global||self,global.d3=global.d3||{},global.d3.x3dom=factory(global.d3,global.d3,global.d3))})(this,function(d3,d3Shape,d3Array){"use strict";var version="1.3.5";var license="GPL-2.0";function curvePolator(points,curve,epsilon,samples){var path=d3Shape.line().curve(curve)(points);return svgPathInterpolator(path,epsilon,samples)}function svgPathInterpolator(path,epsilon,samples){path=path||"M0,0L1,1";var area=document.createElementNS("http://www.w3.org/2000/svg","svg");area.innerHTML="<path></path>";var svgpath=area.querySelector("path");svgpath.setAttribute("d",path);var totalLength=svgpath.getTotalLength();var minPoint=svgpath.getPointAtLength(0);var maxPoint=svgpath.getPointAtLength(totalLength);var reverse=maxPoint.x<minPoint.x;var range=reverse?[maxPoint,minPoint]:[minPoint,maxPoint];reverse=reverse?-1:1;return function(x){var targetX=x===0?0:x||minPoint.x;if(targetX<range[0].x)return range[0];if(targetX>range[1].x)return range[1];function estimateLength(l,mn,mx){var delta=svgpath.getPointAtLength(l).x-targetX;var nextDelta=0;var iter=0;while(Math.abs(delta)>epsilon&&iter<samples){if(iter>samples)return false;iter++;if(reverse*delta<0){mn=l;l=(l+mx)/2}else{mx=l;l=(mn+l)/2}nextDelta=svgpath.getPointAtLength(l).x-targetX;delta=nextDelta}return l}var estimatedLength=estimateLength(totalLength/2,0,totalLength);return svgpath.getPointAtLength(estimatedLength).y}}function fromCurve(values,curve){var epsilon=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1e-5;var samples=arguments.length>3&&arguments[3]!==undefined?arguments[3]:100;var length=values.length;var xrange=d3Array.range(length).map(function(d,i){return i*(1/(length-1))});var points=values.map(function(v,i){return[xrange[i],v]});return curvePolator(points,curve,epsilon,samples)}var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();function dataTransform(data){var SINGLE_SERIES=1;var MULTI_SERIES=2;var coordinates=["x","y","z"];var dataType=function dataType(data){return data.key!==undefined?SINGLE_SERIES:MULTI_SERIES};var union=function union(array1,array2){var ret=[];var arr=array1.concat(array2);var len=arr.length;var assoc={};while(len--){var item=arr[len];if(!assoc[item]){ret.unshift(item);assoc[item]=true}}return ret};var decimalPlaces=function decimalPlaces(num){var match=(""+num).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);if(!match){return 0}return Math.max(0,(match[1]?match[1].length:0)-(match[2]?+match[2]:0))};var singleRowKey=function singleRowKey(data){return d3.values(data)[0]};var singleRowTotal=function singleRowTotal(data){return d3.sum(data.values,function(d){return d.value})};var singleRowValueKeys=function singleRowValueKeys(data){return Object.keys(data.values[0])};var singleColumnKeys=function singleColumnKeys(data){return d3.values(data.values).map(function(d){return d.key})};var singleValueMin=function singleValueMin(data){return d3.min(data.values,function(d){return+d.value})};var singleValueMax=function singleValueMax(data){return d3.max(data.values,function(d){return+d.value})};var singleValueExtent=function singleValueExtent(data){return d3.extent(data.values,function(d){return+d.value})};var singleCoordinatesMin=function singleCoordinatesMin(data){return coordinates.reduce(function(maximums,coord){maximums[coord]=d3.min(data.values,function(d){return+d[coord]});return maximums},{})};var singleCoordinatesMax=function singleCoordinatesMax(data){return coordinates.reduce(function(maximums,coord){maximums[coord]=d3.max(data.values,function(d){return+d[coord]});return maximums},{})};var singleCoordinatesExtent=function singleCoordinatesExtent(data){return coordinates.reduce(function(extents,coord){extents[coord]=d3.extent(data.values,function(d){return+d[coord]});return extents},{})};var singleThresholds=function singleThresholds(data){var bands=[.15,.4,.55,.9];var min=singleValueMin(data);var max=singleValueMax(data);var distance=max-min;return bands.map(function(v){return Number((min+v*distance).toFixed(singleMaxDecimalPlace(data)))})};var singleMaxDecimalPlace=function singleMaxDecimalPlace(data){return data.values.reduce(function(places,d){places=d3.max([places,decimalPlaces(d.value)]);return places>20?20:places},0)};var singleSummary=function singleSummary(data){return{dataType:dataType(data),rowKey:singleRowKey(data),rowTotal:singleRowTotal(data),columnKeys:singleColumnKeys(data),valueMin:singleValueMin(data),valueMax:singleValueMax(data),valueExtent:singleValueExtent(data),coordinatesMin:singleCoordinatesMin(data),coordinatesMax:singleCoordinatesMax(data),coordinatesExtent:singleCoordinatesExtent(data),maxDecimalPlace:singleMaxDecimalPlace(data),thresholds:singleThresholds(data),rowValuesKeys:singleRowValueKeys(data)}};var multiRowKeys=function multiRowKeys(data){return data.map(function(d){return d.key})};var multiRowTotals=function multiRowTotals(data){return data.reduce(function(totals,row){totals[row.key]=singleRowTotal(row);return totals},{})};var multiRowTotalsMax=function multiRowTotalsMax(data){return d3.max(d3.values(multiRowTotals(data)))};var multiRowValueKeys=function multiRowValueKeys(data){return Object.keys(data[0].values[0])};var multiColumnKeys=function multiColumnKeys(data){return data.reduce(function(keys,row){var tmp=[];row.values.forEach(function(d,i){tmp[i]=d.key});keys=union(tmp,keys);return keys},[])};var multiColumnTotals=function multiColumnTotals(data){return data.reduce(function(totals,row){row.values.forEach(function(d){var columnName=d.key;totals[columnName]=typeof totals[columnName]==="undefined"?0:totals[columnName];totals[columnName]+=d.value});return totals},{})};var multiColumnTotalsMax=function multiColumnTotalsMax(data){return d3.max(d3.values(multiColumnTotals(data)))};var multiValueMin=function multiValueMin(data){return d3.min(data.map(function(row){return singleValueMin(row)}))};var multiValueMax=function multiValueMax(data){return d3.max(data.map(function(row){return singleValueMax(row)}))};var multiValueExtent=function multiValueExtent(data){return[multiValueMin(data),multiValueMax(data)]};var multiCoordinatesMin=function multiCoordinatesMin(data){return data.map(function(row){return singleCoordinatesMin(row)}).reduce(function(minimums,row){coordinates.forEach(function(coord){minimums[coord]=coord in minimums?d3.min([minimums[coord],+row[coord]]):row[coord]});return minimums},{})};var multiCoordinatesMax=function multiCoordinatesMax(data){return data.map(function(row){return singleCoordinatesMax(row)}).reduce(function(maximums,row){coordinates.forEach(function(coord){maximums[coord]=coord in maximums?d3.max([maximums[coord],+row[coord]]):row[coord]});return maximums},{})};var multiCoordinatesExtent=function multiCoordinatesExtent(data){return coordinates.reduce(function(extents,coord){extents[coord]=[multiCoordinatesMin(data)[coord],multiCoordinatesMax(data)[coord]];return extents},{})};var multiThresholds=function multiThresholds(data){var bands=[.15,.4,.55,.9];var min=multiValueMin(data);var max=multiValueMax(data);var distance=max-min;return bands.map(function(v){return Number((min+v*distance).toFixed(multiMaxDecimalPlace(data)))})};var multiMaxDecimalPlace=function multiMaxDecimalPlace(data){return d3.max(d3.map(data).values().reduce(function(places,row,i){places[i]=singleMaxDecimalPlace(row);return places},[]))};var multiSummary=function multiSummary(data){return{dataType:dataType(data),rowKeys:multiRowKeys(data),rowTotals:multiRowTotals(data),rowTotalsMax:multiRowTotalsMax(data),columnKeys:multiColumnKeys(data),columnTotals:multiColumnTotals(data),columnTotalsMax:multiColumnTotalsMax(data),valueMin:multiValueMin(data),valueMax:multiValueMax(data),valueExtent:multiValueExtent(data),coordinatesMin:multiCoordinatesMin(data),coordinatesMax:multiCoordinatesMax(data),coordinatesExtent:multiCoordinatesExtent(data),maxDecimalPlace:multiMaxDecimalPlace(data),thresholds:multiThresholds(data),rowValuesKeys:multiRowValueKeys(data)}};var summary=function summary(){if(dataType(data)===SINGLE_SERIES){return singleSummary(data)}else{return multiSummary(data)}};var rotate=function rotate(){var columnKeys=data.map(function(d){return d.key});var rowKeys=data[0].values.map(function(d){return d.key});var rotated=rowKeys.map(function(rowKey,rowIndex){var values=columnKeys.map(function(columnKey,columnIndex){var values=_extends({},data[columnIndex].values[rowIndex]);values.key=columnKey;return values});return{key:rowKey,values:values}});return rotated};var smooth=function smooth(curveFunction){var epsilon=1e-5;var samples=100;var values=data.values.map(function(d){return d.value});var sampler=d3.range(0,1,1/samples);var keyPolator=function keyPolator(t){return Number((t*samples).toFixed(0))+1};var valuePolator=curveFunction===d3.curveBasis?d3.interpolateBasis(values):fromCurve(values,curveFunction,epsilon,samples);var smoothed={key:data.key,values:sampler.map(function(t){return{key:keyPolator(t),value:valuePolator(t)}})};return smoothed};return{summary:summary,rotate:rotate,smooth:smooth}}function componentArea(){var dimensions={x:40,y:40,z:5};var color="blue";var transparency=.1;var classed="d3X3domArea";var smoothed=d3.curveMonotoneX;var xScale=void 0;var yScale=void 0;var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y;if(typeof xScale==="undefined"){xScale=d3.scalePoint().domain(columnKeys).range([0,dimensionX])}if(typeof yScale==="undefined"){yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY])}};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true).attr("id",function(d){return d.key});var areaData=function areaData(data){var dimensionX=dimensions.x;if(smoothed){data=dataTransform(data).smooth(smoothed);var keys=d3.extent(data.values.map(function(d){return d.key}));xScale=d3.scaleLinear().domain(keys).range([0,dimensionX])}var values=data.values;var coords=values.map(function(pointThis,indexThis,array){var indexNext=indexThis+1;if(indexNext>=array.length){return null}var pointNext=array[indexNext];var x1=xScale(pointThis.key);var x2=xScale(pointNext.key);var y1=yScale(pointThis.value);var y2=yScale(pointNext.value);return[x1,0,0,x1,y1,0,x2,y2,0,x2,0,0]}).filter(function(d){return d!==null});data.point=coords.map(function(d){return d.join(" ")}).join(" ");data.coordIndex=coords.map(function(d,i){var offset=i*4;return[offset,offset+1,offset+2,offset+3,-1].join(" ")}).join(" ");return[data]};var shape=function shape(el){var shape=el.append("Shape");shape.html(function(d){return'\n\t\t\t\t\t<IndexedFaceset coordIndex="'+d.coordIndex+'" solid="false">\n\t\t\t\t\t\t<Coordinate point="'+d.point+'"></Coordinate>\n\t\t\t\t\t</IndexedFaceset>\n\t\t\t\t\t<Appearance>\n\t\t\t\t\t\t<Material diffuseColor="'+color+'" transparency="'+transparency+'"></Material>\n\t\t\t\t\t</Appearance>\n\t\t\t\t'})};var area=element.selectAll(".area").data(function(d){return areaData(d)},function(d){return d.key});area.enter().append("Group").classed("area",true).call(shape).merge(area);var areaTransition=area.transition().select("Shape");areaTransition.select("IndexedFaceset").attr("coordIndex",function(d){return d.coordIndex}).select("Coordinate").attr("point",function(d){return d.point});areaTransition.select("Appearance").select("Material").attr("diffuseColor",function(d){return d.color});area.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.color=function(_v){if(!arguments.length)return color;color=_v;return my};my.smoothed=function(_v){if(!arguments.length)return smoothed;smoothed=_v;return my};return my}function componentAreaMultiSeries(){var dimensions={x:40,y:40,z:40};var colors=["orange","red","yellow","steelblue","green"];var classed="d3X3domAreaMultiSeries";var smoothed=d3.curveMonotoneX;var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var colorDomain=[];var area=componentArea();var arrayUnique=function arrayUnique(array1,array2){var array=array1.concat(array2);var a=array.concat();for(var i=0;i<a.length;++i){for(var j=i+1;j<a.length;++j){if(a[i]===a[j]){a.splice(j--,1)}}}return a};var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scalePoint().domain(columnKeys).range([0,dimensionX]);yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY]);zScale=d3.scaleBand().domain(rowKeys).range([0,dimensionZ]).padding(.4);colorDomain=arrayUnique(colorDomain,rowKeys);colorScale=d3.scaleOrdinal().domain(colorDomain).range(colors)};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true);area.xScale(xScale).yScale(yScale).dimensions({x:dimensions.x,y:dimensions.y,z:zScale.bandwidth()}).smoothed(smoothed);var addArea=function addArea(d){var color=colorScale(d.key);area.color(color);d3.select(this).call(area)};var areaGroup=element.selectAll(".areaGroup").data(function(d){return d},function(d){return d.key});areaGroup.enter().append("Transform").classed("areaGroup",true).merge(areaGroup).transition().attr("translation",function(d){var x=0;var y=0;var z=zScale(d.key);return x+" "+y+" "+z}).each(addArea);areaGroup.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.smoothed=function(_v){if(!arguments.length)return smoothed;smoothed=_v;return my};return my}var dispatch=d3.dispatch("d3X3domClick","d3X3domMouseOver","d3X3domMouseOut");function forwardEvent(event){var type=event.type;var target=d3.select(event.target);target.on(type)(event)}function getEventCoordinates(event){var pagePoint=getEventPagePoint(event);return{world:{x:event.hitPnt[0],y:event.hitPnt[1],z:event.hitPnt[2]},canvas:{x:event.layerX,y:event.layerY},page:{x:pagePoint.x,y:pagePoint.y}}}function getEventPagePoint(event){var pageX=-1;var pageY=-1;var convertPoint=window.webkitConvertPointFromPageToNode;if("getBoundingClientRect"in document.documentElement){var holder=getX3domHolder(event);var computedStyle=document.defaultView.getComputedStyle(holder,null);var paddingLeft=parseFloat(computedStyle.getPropertyValue("padding-left"));var borderLeftWidth=parseFloat(computedStyle.getPropertyValue("border-left-width"));var paddingTop=parseFloat(computedStyle.getPropertyValue("padding-top"));var borderTopWidth=parseFloat(computedStyle.getPropertyValue("border-top-width"));var box=holder.getBoundingClientRect();var scrolLeft=window.pageXOffset||document.body.scrollLeft;var scrollTop=window.pageYOffset||document.body.scrollTop;pageX=Math.round(event.layerX+(box.left+paddingLeft+borderLeftWidth+scrolLeft));pageY=Math.round(event.layerY+(box.top+paddingTop+borderTopWidth+scrollTop))}else if(convertPoint){var pagePoint=convertPoint(event.target,new WebKitPoint(0,0));pageX=Math.round(pagePoint.x);pageY=Math.round(pagePoint.y)}else{x3dom.debug.logError("Unable to find getBoundingClientRect or webkitConvertPointFromPageToNode")}return{x:pageX,y:pageY}}function getX3domHolder(event){var target=d3.select(event.target);var x3d=target.select(function(){var el=this;while(el.nodeName.toLowerCase()!=="x3d"){el=el.parentElement}return el});return x3d.select(function(){return this.parentNode}).node()}var events=Object.freeze({dispatch:dispatch,forwardEvent:forwardEvent,getEventCoordinates:getEventCoordinates,getEventPagePoint:getEventPagePoint,getX3domHolder:getX3domHolder});function componentAxis(){var dimensions={x:40,y:40,z:40};var color="black";var classed="d3X3domAxis";var labelPosition="proximal";var labelInset=labelPosition==="distal"?1:-1;var scale=void 0;var direction=void 0;var tickDirection=void 0;var tickArguments=[];var tickValues=null;var tickFormat=null;var tickSize=1.5;var tickPadding=2;var axisDirectionVectors={x:[1,0,0],y:[0,1,0],z:[0,0,1]};var axisRotationVectors={x:[1,1,0,Math.PI],y:[0,0,0,0],z:[0,1,1,Math.PI]};var getAxisDirectionVector=function getAxisDirectionVector(axisDir){return axisDirectionVectors[axisDir]};var getAxisRotationVector=function getAxisRotationVector(axisDir){return axisRotationVectors[axisDir]};var my=function my(selection){selection.each(function(){var element=d3.select(this).classed(classed,true);var range=scale.range();var range0=range[0];var range1=range[range.length-1];var axisDirectionVector=getAxisDirectionVector(direction);var tickDirectionVector=getAxisDirectionVector(tickDirection);var axisRotationVector=getAxisRotationVector(direction);var tickRotationVector=getAxisRotationVector(tickDirection);tickValues=scale.ticks?scale.ticks.apply(scale,tickArguments):scale.domain();var tickFormatDefault=scale.tickFormat?scale.tickFormat.apply(scale,tickArguments):function(d){return d};tickFormat=tickFormat===null?tickFormatDefault:tickFormat;var shape=function shape(el,radius,height,color){var shape=el.append("Shape");shape.append("Cylinder").attr("radius",radius).attr("height",height);shape.append("Appearance").append("Material").attr("diffuseColor",color)};var makeSolid=function makeSolid(el,color){el.append("Appearance").append("Material").attr("diffuseColor",color||"black")};var domain=element.selectAll(".domain").data([null]);domain.enter().append("Transform").attr("class","domain").attr("rotation",axisRotationVector.join(" ")).attr("translation",axisDirectionVector.map(function(d){return d*(range0+range1)/2}).join(" ")).call(shape,.1,range1-range0,color).merge(domain);domain.exit().remove();var ticks=element.selectAll(".tick").data(tickValues,function(d){return d});ticks.enter().append("Transform").attr("class","tick").attr("translation",function(t){return axisDirectionVector.map(function(a){return scale(t)*a}).join(" ")}).append("Transform").attr("translation",tickDirectionVector.map(function(d){return d*tickSize/2}).join(" ")).attr("rotation",tickRotationVector.join(" ")).call(shape,.05,tickSize,"#e3e3e3").merge(ticks);ticks.transition().attr("translation",function(t){return axisDirectionVector.map(function(a){return scale(t)*a}).join(" ")});ticks.exit().remove();if(tickFormat!==""){var labels=element.selectAll(".label").data(tickValues,function(d){return d});var labelsEnter=ticks.enter().append("Transform").attr("class","label").attr("translation",function(t){return axisDirectionVector.map(function(a){return scale(t)*a}).join(" ")}).append("Transform").attr("translation",tickDirectionVector.map(function(d,i){return labelInset*d*tickPadding+(labelInset+1)/2*tickSize*tickDirectionVector[i]})).append("Billboard").attr("axisOfRotation","0 0 0").append("Shape").call(makeSolid,"black").append("Text").attr("string",tickFormat).append("FontStyle").attr("size",1.3).attr("family","SANS").attr("style","BOLD").attr("justify","MIDDLE");labelsEnter.merge(labels);labels.transition().attr("translation",function(t){return axisDirectionVector.map(function(a){return scale(t)*a}).join(" ")}).select("Transform").attr("translation",tickDirectionVector.map(function(d,i){return labelInset*d*tickPadding+(labelInset+1)/2*tickSize*tickDirectionVector[i]})).on("start",function(){d3.select(this).select("Billboard").select("Shape").select("Text").attr("string",tickFormat)});labels.exit().remove()}})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return my};my.scale=function(_v){if(!arguments.length)return scale;scale=_v;return my};my.direction=function(_v){if(!arguments.length)return direction;direction=_v;return my};my.tickDirection=function(_v){if(!arguments.length)return tickDirection;tickDirection=_v;return my};my.tickArguments=function(_v){if(!arguments.length)return tickArguments;tickArguments=_v;return my};my.tickValues=function(_v){if(!arguments.length)return tickValues;tickValues=_v;return my};my.tickFormat=function(_v){if(!arguments.length)return tickFormat;tickFormat=_v;return my};my.tickSize=function(_v){if(!arguments.length)return tickSize;tickSize=_v;return my};my.tickPadding=function(_v){if(!arguments.length)return tickPadding;tickPadding=_v;return my};my.color=function(_v){if(!arguments.length)return color;color=_v;return my};my.labelPosition=function(_v){if(!arguments.length)return labelPosition;labelPosition=_v;labelInset=labelPosition==="distal"?1:-1;return my};return my}function componentAxisThreePlane(){var dimensions={x:40,y:40,z:40};var colors=["blue","red","green"];var classed="d3X3domAxisThreePlane";var labelPosition="proximal";var xScale=void 0;var yScale=void 0;var zScale=void 0;var xzAxis=componentAxis();var yzAxis=componentAxis();var yxAxis=componentAxis();var zxAxis=componentAxis();var my=function my(selection){selection.each(function(){var element=d3.select(this).classed(classed,true);var layers=["xzAxis","yzAxis","yxAxis","zxAxis"];element.selectAll("group").data(layers).enter().append("Group").attr("class",function(d){return d});xzAxis.scale(xScale).direction("x").tickDirection("z").tickSize(zScale.range()[1]-zScale.range()[0]).color("blue").labelPosition(labelPosition);yzAxis.scale(yScale).direction("y").tickDirection("z").tickSize(zScale.range()[1]-zScale.range()[0]).color("red").labelPosition(labelPosition);yxAxis.scale(yScale).direction("y").tickDirection("x").tickSize(xScale.range()[1]-xScale.range()[0]).color("red").labelPosition(labelPosition);zxAxis.scale(zScale).direction("z").tickDirection("x").tickSize(xScale.range()[1]-xScale.range()[0]).color("black").labelPosition(labelPosition);if(labelPosition==="proximal"){yxAxis.tickFormat("")}element.select(".xzAxis").call(xzAxis);element.select(".yzAxis").call(yzAxis);element.select(".yxAxis").call(yxAxis);element.select(".zxAxis").call(zxAxis)})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.labelPosition=function(_v){if(!arguments.length)return labelPosition;labelPosition=_v;return my};return my}function componentBars(){var dimensions={x:40,y:40,z:2};var colors=["orange","red","yellow","steelblue","green"];var classed="d3X3domBars";var xScale=void 0;var yScale=void 0;var colorScale=void 0;var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y;if(typeof xScale==="undefined"){xScale=d3.scaleBand().domain(columnKeys).rangeRound([0,dimensionX]).padding(.3)}if(typeof yScale==="undefined"){yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY])}if(typeof colorScale==="undefined"){colorScale=d3.scaleOrdinal().domain(columnKeys).range(colors)}};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true).attr("id",function(d){return d.key});var shape=function shape(el){var shape=el.append("Shape").attr("onclick","d3.x3dom.events.forwardEvent(event);").on("click",function(e){dispatch.call("d3X3domClick",this,e)}).attr("onmouseover","d3.x3dom.events.forwardEvent(event);").on("mouseover",function(e){dispatch.call("d3X3domMouseOver",this,e)}).attr("onmouseout","d3.x3dom.events.forwardEvent(event);").on("mouseout",function(e){dispatch.call("d3X3domMouseOut",this,e)});shape.append("Box").attr("size","1.0 1.0 1.0");shape.append("Appearance").append("Material").attr("diffuseColor",function(d){return colorScale(d.key)}).attr("ambientIntensity",.1);return shape};var bars=element.selectAll(".bar").data(function(d){return d.values},function(d){return d.key});bars.enter().append("Transform").classed("bar",true).call(shape).merge(bars).transition().attr("scale",function(d){var x=xScale.bandwidth();var y=yScale(d.value);var z=dimensions.z;return x+" "+y+" "+z}).attr("translation",function(d){var x=xScale(d.key);var y=yScale(d.value)/2;var z=0;return x+" "+y+" "+z});bars.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.on=function(){var value=dispatch.on.apply(dispatch,arguments);return value===dispatch?my:value};return my}function componentBarsMultiSeries(){var dimensions={x:40,y:40,z:40};var colors=["orange","red","yellow","steelblue","green"];var classed="d3X3domBarsMultiSeries";var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var bars=componentBars();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scaleBand().domain(columnKeys).rangeRound([0,dimensionX]).padding(.5);yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY]).nice();zScale=d3.scaleBand().domain(rowKeys).range([0,dimensionZ]).padding(.7);colorScale=d3.scaleOrdinal().domain(columnKeys).range(colors)};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true);bars.xScale(xScale).yScale(yScale).dimensions({x:dimensions.x,y:dimensions.y,z:zScale.bandwidth()}).colors(colors);var addBars=function addBars(){d3.select(this).call(bars)};var barGroup=element.selectAll(".barGroup").data(function(d){return d},function(d){return d.key});barGroup.enter().append("Transform").classed("barGroup",true).merge(barGroup).transition().attr("translation",function(d){var x=0;var y=0;var z=zScale(d.key);return x+" "+y+" "+z}).each(addBars);barGroup.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};return my}function componentBubbles(){var dimensions={x:40,y:40,z:40};var color="orange";var classed="d3X3domBubbles";var xScale=void 0;var yScale=void 0;var zScale=void 0;var sizeScale=void 0;var sizeDomain=[.5,4];var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),valueExtent=_dataTransform$summar.valueExtent,coordinatesMax=_dataTransform$summar.coordinatesMax;var maxX=coordinatesMax.x,maxY=coordinatesMax.y,maxZ=coordinatesMax.z;var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;if(typeof xScale==="undefined"){xScale=d3.scaleLinear().domain([0,maxX]).range([0,dimensionX])}if(typeof yScale==="undefined"){yScale=d3.scaleLinear().domain([0,maxY]).range([0,dimensionY])}if(typeof zScale==="undefined"){zScale=d3.scaleLinear().domain([0,maxZ]).range([0,dimensionZ])}if(typeof sizeScale==="undefined"){sizeScale=d3.scaleLinear().domain(valueExtent).range(sizeDomain)}};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true).attr("id",function(d){return d.key});var shape=function shape(el){var shape=el.append("Shape").attr("onclick","d3.x3dom.events.forwardEvent(event);").on("click",function(e){dispatch.call("d3X3domClick",this,e)}).attr("onmouseover","d3.x3dom.events.forwardEvent(event);").on("mouseover",function(e){dispatch.call("d3X3domMouseOver",this,e)}).attr("onmouseout","d3.x3dom.events.forwardEvent(event);").on("mouseout",function(e){dispatch.call("d3X3domMouseOut",this,e)});shape.append("Sphere").attr("radius",function(d){return sizeScale(d.value)});shape.append("Appearance").append("Material").attr("diffuseColor",color).attr("ambientIntensity",.1);return shape};var bubbles=element.selectAll(".bubble").data(function(d){return d.values},function(d){return d.key});bubbles.enter().append("Transform").attr("class","bubble").call(shape).merge(bubbles).transition().attr("translation",function(d){return xScale(d.x)+" "+yScale(d.y)+" "+zScale(d.z)}).select("Shape").select("Appearance").select("Material").attr("diffuseColor",color);bubbles.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.sizeScale=function(_v){if(!arguments.length)return sizeScale;sizeScale=_v;return my};my.sizeDomain=function(_v){if(!arguments.length)return sizeDomain;sizeDomain=_v;return my};my.color=function(_v){if(!arguments.length)return color;color=_v;return my};my.on=function(){var value=dispatch.on.apply(dispatch,arguments);return value===dispatch?my:value};return my}function componentBubblesMultiSeries(){var dimensions={x:40,y:40,z:40};var colors=["green","red","yellow","steelblue","orange"];var classed="d3X3domBubblesMultiSeries";var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var sizeScale=void 0;var sizeDomain=[.5,3];var colorDomain=[];var bubbles=componentBubbles();var arrayUnique=function arrayUnique(array1,array2){var array=array1.concat(array2);var a=array.concat();for(var i=0;i<a.length;++i){for(var j=i+1;j<a.length;++j){if(a[i]===a[j]){a.splice(j--,1)}}}return a};var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,valueExtent=_dataTransform$summar.valueExtent,coordinatesMax=_dataTransform$summar.coordinatesMax;var maxX=coordinatesMax.x,maxY=coordinatesMax.y,maxZ=coordinatesMax.z;var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scaleLinear().domain([0,maxX]).range([0,dimensionX]);yScale=d3.scaleLinear().domain([0,maxY]).range([0,dimensionY]);zScale=d3.scaleLinear().domain([0,maxZ]).range([0,dimensionZ]);colorDomain=arrayUnique(colorDomain,rowKeys);colorScale=d3.scaleOrdinal().domain(colorDomain).range(colors);sizeScale=d3.scaleLinear().domain(valueExtent).range(sizeDomain)};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true);bubbles.xScale(xScale).yScale(yScale).zScale(zScale).sizeScale(sizeScale);var addBubbles=function addBubbles(d){var color=colorScale(d.key);bubbles.color(color);d3.select(this).datum(d).call(bubbles)};var bubbleGroup=element.selectAll(".bubbleGroup").data(function(d){return d},function(d){return d.key});bubbleGroup.enter().append("Group").classed("bubbleGroup",true).merge(bubbleGroup).transition().each(addBubbles);bubbleGroup.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.sizeScale=function(_v){if(!arguments.length)return sizeScale;sizeScale=_v;return my};my.sizeDomain=function(_v){if(!arguments.length)return sizeDomain;sizeDomain=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.on=function(){var value=dispatch.on.apply(dispatch,arguments);return value===dispatch?my:value};return my}function componentCrosshair(){var dimensions={x:40,y:40,z:40};var colors=["blue","red","green"];var classed="d3X3domCrosshair";var radius=.1;var xScale=void 0;var yScale=void 0;var zScale=void 0;var my=function my(selection){selection.each(function(data){var element=d3.select(this).classed(classed,true).attr("id",function(d){return d.key});var xOff=dimensions["x"]/2;var yOff=dimensions["y"]/2;var zOff=dimensions["z"]/2;var xVal=xScale(data.x);var yVal=yScale(data.y);var zVal=zScale(data.z);var positionVectors={x:[xOff,yVal,zVal],y:[xVal,yOff,zVal],z:[xVal,yVal,zOff]};function getPositionVector(axisDir){return positionVectors[axisDir].join(" ")}var rotationVectors={x:[1,1,0,Math.PI],y:[0,0,0,0],z:[0,1,1,Math.PI]};function getRotationVector(axisDir){return rotationVectors[axisDir].join(" ")}var colorScale=d3.scaleOrdinal().domain(Object.keys(dimensions)).range(colors);var ballSelect=element.selectAll(".ball").data([data]);var ball=ballSelect.enter().append("Transform").attr("translation",function(d){return xScale(d.x)+" "+yScale(d.y)+" "+zScale(d.z)}).classed("ball",true).append("Shape");ball.append("Appearance").append("Material").attr("diffuseColor","blue");ball.append("Sphere").attr("radius",.3);ball.merge(ballSelect);ballSelect.transition().ease(d3.easeQuadOut).attr("translation",function(d){return xScale(d.x)+" "+yScale(d.y)+" "+zScale(d.z)});var lineSelect=element.selectAll(".line").data(Object.keys(dimensions));var line=lineSelect.enter().append("Transform").classed("line",true).attr("translation",function(d){return getPositionVector(d)}).attr("rotation",function(d){return getRotationVector(d)}).append("Shape");line.append("cylinder").attr("radius",radius).attr("height",function(d){return dimensions[d]});line.append("Appearance").append("Material").attr("diffuseColor",function(d){return colorScale(d)});line.merge(lineSelect);lineSelect.transition().ease(d3.easeQuadOut).attr("translation",function(d){return getPositionVector(d)})})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};return my}function componentLabel(){var dimensions={x:40,y:40,z:40};var color="black";var classed="d3X3domLabel";var offset=0;var xScale=void 0;var yScale=void 0;var zScale=void 0;var my=function my(selection){selection.each(function(data){var element=d3.select(this).classed(classed,true).attr("id",function(d){return d.key});var makeSolid=function makeSolid(el,color){el.append("Appearance").append("Material").attr("diffuseColor",color||"black")};var labelSelect=element.selectAll(".label").data([data]);var label=labelSelect.enter().append("Transform").attr("translation",function(d){return xScale(d.x)+" "+yScale(d.y)+" "+zScale(d.z)}).classed("label",true).append("Billboard").attr("axisOfRotation","0 0 0").append("Transform").attr("translation",function(d){return offset+" "+offset+" "+offset}).append("Shape").call(makeSolid,color).append("Text").attr("string",function(d){return d.key}).append("FontStyle").attr("size",1).attr("family","SANS").attr("style","BOLD").attr("justify","START");label.merge(labelSelect);labelSelect.transition().ease(d3.easeQuadOut).attr("translation",function(d){return xScale(d.x)+" "+yScale(d.y)+" "+zScale(d.z)})})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.color=function(_v){if(!arguments.length)return color;color=_v;return my};my.offset=function(_v){if(!arguments.length)return offset;offset=_v;return my};return my}function componentLight(){var classed="d3X3domLight";var direction="1 0 -1";var intensity=.5;var shadowIntensity=0;var my=function my(selection){selection.each(function(){var element=d3.select(this).classed(classed,true);var light=element.selectAll("DirectionalLight").data([null]);light.enter().append("DirectionalLight").attr("on",true).attr("direction",direction).attr("intensity",intensity).attr("shadowIntensity",shadowIntensity).merge(light)})};my.direction=function(_v){if(!arguments.length)return direction;direction=_v;return my};my.intensity=function(_v){if(!arguments.length)return intensity;intensity=_v;return my};my.shadowIntensity=function(_v){if(!arguments.length)return shadowIntensity;shadowIntensity=_v;return my};return my}function componentRibbon(){var dimensions={x:40,y:40,z:5};var color="red";var transparency=.2;var classed="d3X3domRibbon";var xScale=void 0;var yScale=void 0;var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y;if(typeof xScale==="undefined"){xScale=d3.scalePoint().domain(columnKeys).range([0,dimensionX])}if(typeof yScale==="undefined"){yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY])}};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true).attr("id",function(d){return d.key});var ribbonData=function ribbonData(data){var values=data.values;var coords=values.map(function(pointThis,indexThis,array){var indexNext=indexThis+1;if(indexNext>=array.length){return null}var pointNext=array[indexNext];var x1=xScale(pointThis.key);var x2=xScale(pointNext.key);var y1=yScale(pointThis.value);var y2=yScale(pointNext.value);var z1=1-dimensions.z/2;var z2=dimensions.z/2;return[x1,y1,z1,x1,y1,z2,x2,y2,z2,x2,y2,z1]}).filter(function(d){return d!==null});data.point=coords.map(function(d){return d.join(" ")}).join(" ");data.coordIndex=coords.map(function(d,i){var offset=i*4;return[offset,offset+1,offset+2,offset+3,-1].join(" ")}).join(" ");return[data]};var shape=function shape(el){var shape=el.append("Shape");shape.attr("onclick","d3.x3dom.events.forwardEvent(event);").on("click",function(e){dispatch.call("d3X3domClick",this,e)}).attr("onmouseover","d3.x3dom.events.forwardEvent(event);").on("mouseover",function(e){dispatch.call("d3X3domMouseOver",this,e)}).attr("onmouseout","d3.x3dom.events.forwardEvent(event);").on("mouseout",function(e){dispatch.call("d3X3domMouseOut",this,e)});shape.html(function(d){return'\n\t\t\t\t\t<IndexedFaceset coordIndex="'+d.coordIndex+'">\n\t\t\t\t\t\t<Coordinate point="'+d.point+'"></Coordinate>\n\t\t\t\t\t</IndexedFaceset>\n\t\t\t\t\t<Appearance>\n\t\t\t\t\t\t<TwoSidedMaterial diffuseColor="'+color+'" transparency="'+transparency+'"></TwoSidedMaterial>\n\t\t\t\t\t</Appearance>\n\t\t\t\t'})};var ribbon=element.selectAll(".ribbon").data(function(d){return ribbonData(d)},function(d){return d.key});ribbon.enter().append("Group").classed("ribbon",true).call(shape).merge(ribbon);var ribbonTransition=ribbon.transition().select("Shape");ribbonTransition.select("IndexedFaceset").attr("coordIndex",function(d){return d.coordIndex}).select("Coordinate").attr("point",function(d){return d.point});ribbonTransition.select("Appearance").select("TwoSidedMaterial").attr("diffuseColor",function(d){return d.color});ribbon.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.color=function(_v){if(!arguments.length)return color;color=_v;return my};my.on=function(){var value=dispatch.on.apply(dispatch,arguments);return value===dispatch?my:value};return my}function componentRibbonMultiSeries(){var dimensions={x:40,y:40,z:40};var colors=["orange","red","yellow","steelblue","green"];var classed="d3X3domRibbonMultiSeries";var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var colorDomain=[];var ribbon=componentRibbon();var arrayUnique=function arrayUnique(array1,array2){var array=array1.concat(array2);var a=array.concat();for(var i=0;i<a.length;++i){for(var j=i+1;j<a.length;++j){if(a[i]===a[j]){a.splice(j--,1)}}}return a};var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scalePoint().domain(columnKeys).range([0,dimensionX]);yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY]);zScale=d3.scaleBand().domain(rowKeys).range([0,dimensionZ]).padding(.4);colorDomain=arrayUnique(colorDomain,rowKeys);colorScale=d3.scaleOrdinal().domain(colorDomain).range(colors)};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true);ribbon.xScale(xScale).yScale(yScale).dimensions({x:dimensions.x,y:dimensions.y,z:zScale.bandwidth()});var addRibbon=function addRibbon(d){var color=colorScale(d.key);ribbon.color(color);d3.select(this).call(ribbon)};var ribbonGroup=element.selectAll(".ribbonGroup").data(function(d){return d},function(d){return d.key});ribbonGroup.enter().append("Transform").classed("ribbonGroup",true).merge(ribbonGroup).transition().attr("translation",function(d){var x=0;var y=0;var z=zScale(d.key);return x+" "+y+" "+z}).each(addRibbon);ribbonGroup.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.on=function(){var value=dispatch.on.apply(dispatch,arguments);return value===dispatch?my:value};return my}function componentSurface(){var dimensions={x:40,y:40,z:40};var colors=["orange","maroon"];var classed="d3X3domSurface";var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var array2dToString=function array2dToString(arr){return arr.reduce(function(a,b){return a.concat(b)},[]).reduce(function(a,b){return a.concat(b)},[]).join(" ")};var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;if(typeof xScale==="undefined"){xScale=d3.scalePoint().domain(rowKeys).range([0,dimensionX])}if(typeof yScale==="undefined"){yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY])}if(typeof zScale==="undefined"){zScale=d3.scalePoint().domain(columnKeys).range([0,dimensionZ])}if(typeof colorScale==="undefined"){colorScale=d3.scaleLinear().domain(valueExtent).range(colors).interpolate(d3.interpolateLab)}};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true);var surfaceData=function surfaceData(d){var coordPoints=function coordPoints(data){return data.map(function(X){return X.values.map(function(d){return[xScale(X.key),yScale(d.value),zScale(d.key)]})})};var coordIndex=function coordIndex(data){var ny=data.length;var nx=data[0].values.length;var coordIndexFront=Array.apply(0,Array(ny-1)).map(function(_,j){return Array.apply(0,Array(nx-1)).map(function(_,i){var start=i+j*nx;return[start,start+nx,start+nx+1,start+1,start,-1]})});var coordIndexBack=Array.apply(0,Array(ny-1)).map(function(_,j){return Array.apply(0,Array(nx-1)).map(function(_,i){var start=i+j*nx;return[start,start+1,start+nx+1,start+nx,start,-1]})});return coordIndexFront.concat(coordIndexBack)};var colorFaceSet=function colorFaceSet(data){return data.map(function(X){return X.values.map(function(d){var col=d3.color(colorScale(d.value));return""+Math.round(col.r/2.55)/100+" "+Math.round(col.g/2.55)/100+" "+Math.round(col.b/2.55)/100})})};return[{coordIndex:array2dToString(coordIndex(d)),point:array2dToString(coordPoints(d)),color:array2dToString(colorFaceSet(d))}]};var surface=element.selectAll(".surface").data(surfaceData);var surfaceSelect=surface.enter().append("Shape").classed("surface",true).append("IndexedFaceset").attr("coordIndex",function(d){return d.coordIndex});surfaceSelect.append("Coordinate").attr("point",function(d){return d.point});surfaceSelect.append("Color").attr("color",function(d){return d.color});surfaceSelect.merge(surface);var surfaceTransition=surface.transition().select("IndexedFaceset").attr("coordIndex",function(d){return d.coordIndex});surfaceTransition.select("coordinate").attr("point",function(d){return d.point});surfaceTransition.select("color").attr("color",function(d){return d.color});surface.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.on=function(){var value=dispatch.on.apply(dispatch,arguments);return value===dispatch?my:value};return my}function componentVectorFields(){var dimensions={x:40,y:40,z:40};var colors=d3.interpolateRdYlGn;var classed="d3X3domVectorFields";var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var sizeScale=void 0;var sizeDomain=[2,5];var vectorFunction=function vectorFunction(x,y,z){return{vx:x,vy:y,vz:z}};var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),coordinatesMax=_dataTransform$summar.coordinatesMax,coordinatesMin=_dataTransform$summar.coordinatesMin;var minX=coordinatesMin.x,minY=coordinatesMin.y,minZ=coordinatesMin.z;var maxX=coordinatesMax.x,maxY=coordinatesMax.y,maxZ=coordinatesMax.z;var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;var extent=d3.extent(data.values.map(function(f){var vx=void 0,vy=void 0,vz=void 0;if("vx"in f){vx=f.vx;vy=f.vy;vz=f.vz}else{var _vectorFunction=vectorFunction(f.x,f.y,f.z,f.value);vx=_vectorFunction.vx;vy=_vectorFunction.vy;vz=_vectorFunction.vz}return new x3dom.fields.SFVec3f(vx,vy,vz).length()}));if(typeof xScale==="undefined"){xScale=d3.scaleLinear().domain([minX,maxX]).range([0,dimensionX])}if(typeof yScale==="undefined"){yScale=d3.scaleLinear().domain([minY,maxY]).range([0,dimensionY])}if(typeof zScale==="undefined"){zScale=d3.scaleLinear().domain([minZ,maxZ]).range([0,dimensionZ])}if(typeof colorScale==="undefined"){colorScale=d3.scaleSequential().domain(extent.slice().reverse()).interpolator(colors)}if(typeof sizeScale==="undefined"){sizeScale=d3.scaleLinear().domain(extent).range(sizeDomain)}};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true).attr("id",function(d){return d.key});var vectorData=function vectorData(d){return d.values.map(function(f){var vx=void 0,vy=void 0,vz=void 0;if("vx"in f){vx=f.vx;vy=f.vy;vz=f.vz}else{var _vectorFunction2=vectorFunction(f.x,f.y,f.z,f.value);vx=_vectorFunction2.vx;vy=_vectorFunction2.vy;vz=_vectorFunction2.vz}var fromVector=new x3dom.fields.SFVec3f(0,1,0);var toVector=new x3dom.fields.SFVec3f(vx,vy,vz);var qDir=x3dom.fields.Quaternion.rotateFromTo(fromVector,toVector);var rot=qDir.toAxisAngle();if(!toVector.length()){return null}f.translation=xScale(f.x)+" "+yScale(f.y)+" "+zScale(f.z);f.value=toVector.length();f.rotation=rot[0].x+" "+rot[0].y+" "+rot[0].z+" "+rot[1];return f}).filter(function(f){return f!==null})};var arrows=element.selectAll(".arrow").data(vectorData);var arrowsEnter=arrows.enter().append("Transform").attr("translation",function(d){return d.translation}).attr("rotation",function(d){return d.rotation}).attr("class","arrow").append("Transform").attr("translation",function(d){var offset=sizeScale(d.value)/2;return"0 "+offset+" 0"}).append("Group").attr("onclick","d3.x3dom.events.forwardEvent(event);").attr("onmouseover","d3.x3dom.events.forwardEvent(event);").attr("onmouseout","d3.x3dom.events.forwardEvent(event);");var arrowHead=arrowsEnter.append("Shape").on("click",function(e){dispatch.call("d3X3domClick",this,e)}).on("mouseover",function(e){dispatch.call("d3X3domMouseOver",this,e)}).on("mouseout",function(e){dispatch.call("d3X3domMouseOut",this,e)});arrowHead.append("Appearance").append("Material").attr("diffuseColor",function(d){return rgb2Hex(colorScale(d.value))});arrowHead.append("Cylinder").attr("height",function(d){return sizeScale(d.value)}).attr("radius",.1);var arrowShaft=arrowsEnter.append("Transform").attr("translation",function(d){var offset=sizeScale(d.value)/2;return"0 "+offset+" 0"}).append("Shape").on("click",function(e){dispatch.call("d3X3domClick",this,e)}).on("mouseover",function(e){dispatch.call("d3X3domMouseOver",this,e)}).on("mouseout",function(e){dispatch.call("d3X3domMouseOut",this,e)});arrowShaft.append("Appearance").append("Material").attr("diffuseColor",function(d){return rgb2Hex(colorScale(d.value))});arrowShaft.append("cone").attr("height",1).attr("bottomRadius",.4);arrowsEnter.merge(arrows);arrows.transition().attr("translation",function(d){return d.translation});arrows.exit().remove()})};function rgb2Hex(rgbStr){var _rgbStr$substring$rep=rgbStr.substring(4,rgbStr.length-1).replace(/ /g,"").split(","),_rgbStr$substring$rep2=slicedToArray(_rgbStr$substring$rep,3),red=_rgbStr$substring$rep2[0],green=_rgbStr$substring$rep2[1],blue=_rgbStr$substring$rep2[2];var rgb=blue|green<<8|red<<16;return"#"+(16777216+rgb).toString(16).slice(1)}my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.sizeScale=function(_v){if(!arguments.length)return sizeScale;sizeScale=_v;return my};my.sizeDomain=function(_v){if(!arguments.length)return sizeDomain;sizeDomain=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.vectorFunction=function(_f){if(!arguments.length)return vectorFunction;vectorFunction=_f;return my};my.on=function(){var value=dispatch.on.apply(dispatch,arguments);return value===dispatch?my:value};return my}function componentViewpoint(){var centerOfRotation=[0,0,0];var viewPosition=[80,15,80];var viewOrientation=[0,1,0,.8];var fieldOfView=.8;var classed="d3X3domViewpoint";var my=function my(selection){selection.each(function(){var element=d3.select(this).classed(classed,true);var viewpoint=element.selectAll("viewpoint").data([null]);viewpoint.enter().append("Viewpoint").attr("centerOfRotation",centerOfRotation.join(" ")).attr("position",viewPosition.join(" ")).attr("orientation",viewOrientation.join(" ")).attr("fieldOfView",fieldOfView).attr("set_bind","true").merge(viewpoint)})};my.quickView=function(view){switch(view){case"left":centerOfRotation=[0,0,0];viewPosition=[37.10119,18.70484,51.01594];viewOrientation=[.06724,.99767,-.01148,.33908];fieldOfView=1;break;case"side":centerOfRotation=[20,0,0];viewPosition=[20,20,50];viewOrientation=[0,0,0,0];fieldOfView=1;break;case"top":centerOfRotation=[0,0,0];viewPosition=[27.12955,106.67181,31.65828];viewOrientation=[-.86241,.3749,.34013,1.60141];fieldOfView=1;break;case"dimetric":default:centerOfRotation=[0,0,0];viewPosition=[80,15,80];viewOrientation=[0,1,0,.8];fieldOfView=.8}return my};my.centerOfRotation=function(_v){if(!arguments.length)return centerOfRotation;centerOfRotation=_v;return my};my.viewPosition=function(_v){if(!arguments.length)return viewPosition;viewPosition=_v;return my};my.viewOrientation=function(_v){if(!arguments.length)return viewOrientation;viewOrientation=_v;return my};my.fieldOfView=function(_v){if(!arguments.length)return fieldOfView;fieldOfView=_v;return my};return my}function componentVolumeSlice(){var dimensions={x:40,y:40,z:40};var classed="d3X3domVolumeSlice";var imageUrl=void 0;var numberOfSlices=void 0;var slicesOverX=void 0;var slicesOverY=void 0;var volumeStyle="OpacityMap";var my=function my(selection){selection.each(function(data){var element=d3.select(this).classed(classed,true).attr("id",function(d){return d.key});var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;var volumedata=element.append("Transform").append("VolumeData").attr("dimensions",dimensionX+" "+dimensionY+" "+dimensionZ);volumedata.append("ImageTextureAtlas").attr("crossOrigin","anonymous").attr("containerField","voxels").attr("url",imageUrl).attr("numberOfSlices",numberOfSlices).attr("slicesOverX",slicesOverX).attr("slicesOverY",slicesOverY);switch(volumeStyle){case"MPRVolume":volumedata.append("MPRVolumeStyle").attr("forceOpaic",true).selectAll(".plane").data(function(d){return d.values}).enter().append("MPRPlane").classed("plane",true).attr("normal",function(d){return d.x+" "+d.y+" "+d.z}).attr("position",function(d){return d.value});break;case"OpacityMap":default:volumedata.append("OpacityMapVolumeStyle").attr("lightFactor",1.2).attr("opacityFactor",6);break}})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.imageUrl=function(_v){if(!arguments.length)return imageUrl;imageUrl=_v;return this};my.numberOfSlices=function(_v){if(!arguments.length)return numberOfSlices;numberOfSlices=_v;return this};my.slicesOverX=function(_v){if(!arguments.length)return slicesOverX;slicesOverX=_v;return this};my.slicesOverY=function(_v){if(!arguments.length)return slicesOverY;slicesOverY=_v;return this};my.volumeStyle=function(_v){if(!arguments.length)return volumeStyle;volumeStyle=_v;return this};return my}var component={area:componentArea,areaMultiSeries:componentAreaMultiSeries,axis:componentAxis,axisThreePlane:componentAxisThreePlane,bars:componentBars,barsMultiSeries:componentBarsMultiSeries,bubbles:componentBubbles,bubblesMultiSeries:componentBubblesMultiSeries,crosshair:componentCrosshair,label:componentLabel,light:componentLight,ribbon:componentRibbon,ribbonMultiSeries:componentRibbonMultiSeries,surface:componentSurface,vectorFields:componentVectorFields,viewpoint:componentViewpoint,volumeSlice:componentVolumeSlice};function chartAreaChartMultiSeries(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:60,y:40,z:40};var colors=["green","red","yellow","steelblue","orange"];var classed="d3X3domAreaChartMultiSeries";var debug=false;var smoothed=d3.curveMonotoneX;var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var viewpoint=component.viewpoint();var axis=component.axisThreePlane().labelPosition("distal");var areas=component.areaMultiSeries();var light=component.light();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scalePoint().domain(columnKeys).range([0,dimensionX]);yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY]).nice();zScale=d3.scaleBand().domain(rowKeys).range([0,dimensionZ]).padding(.4);colorScale=d3.scaleOrdinal().domain(columnKeys).range(colors)};var my=function my(selection){if(!x3d){x3d=selection.append("X3D");scene=x3d.append("Scene")}x3d.attr("width",width+"px").attr("useGeoCache",false).attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","areas"];scene.classed(classed,true).selectAll("Group").data(layers).enter().append("Group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]).viewOrientation([-.61021,.77568,.16115,.65629]).viewPosition([77.63865,54.6947,104.38314]);scene.call(viewpoint);axis.xScale(xScale).yScale(yScale).zScale(zScale);scene.select(".axis").call(axis);areas.xScale(xScale).yScale(yScale).zScale(zScale).colors(colors).smoothed(smoothed).dimensions(dimensions);scene.select(".areas").datum(data).call(areas);scene.call(light)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};my.smoothed=function(_v){if(!arguments.length)return smoothed;smoothed=_v;return my};return my}function chartBarChartMultiSeries(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:40,y:40,z:40};var colors=["green","red","yellow","steelblue","orange"];var classed="d3X3domBarChartMultiSeries";var labelPosition="distal";var debug=false;var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var viewpoint=component.viewpoint();var axis=component.axisThreePlane();var bars=component.barsMultiSeries();var light=component.light();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scaleBand().domain(columnKeys).rangeRound([0,dimensionX]).padding(.5);yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY]).nice();zScale=d3.scaleBand().domain(rowKeys).range([0,dimensionZ]).padding(.7);colorScale=d3.scaleOrdinal().domain(columnKeys).range(colors)};var my=function my(selection){if(!x3d){x3d=selection.append("X3D");scene=x3d.append("Scene")}x3d.attr("width",width+"px").attr("useGeoCache",false).attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","bars"];scene.classed(classed,true).selectAll("Group").data(layers).enter().append("Group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]);scene.call(viewpoint);axis.xScale(xScale).yScale(yScale).zScale(zScale).labelPosition(labelPosition);scene.select(".axis").call(axis);bars.xScale(xScale).yScale(yScale).zScale(zScale).colors(colors);scene.select(".bars").datum(data).call(bars);scene.call(light)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};my.labelPosition=function(_v){if(!arguments.length)return labelPosition;labelPosition=_v;return my};return my}function chartBarChartVertical(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:40,y:40,z:40};var colors=["green","red","yellow","steelblue","orange"];var classed="d3X3domBarChartVertical";var debug=false;var xScale=void 0;var yScale=void 0;var colorScale=void 0;var viewpoint=component.viewpoint();var xAxis=component.axis();var yAxis=component.axis();var bars=component.bars();var light=component.light();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y;xScale=d3.scaleBand().domain(columnKeys).rangeRound([0,dimensionX]).padding(.5);yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY]).nice();colorScale=d3.scaleOrdinal().domain(columnKeys).range(colors)};var my=function my(selection){if(!x3d){x3d=selection.append("X3D");scene=x3d.append("Scene")}x3d.attr("width",width+"px").attr("useGeoCache",false).attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["xAxis","yAxis","bars"];scene.classed(classed,true).selectAll("Group").data(layers).enter().append("Group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.quickView("left");scene.call(viewpoint);xAxis.scale(xScale).direction("x").tickDirection("y").tickSize(0);yAxis.scale(yScale).direction("y").tickDirection("x").tickSize(yScale.range()[1]-yScale.range()[0]);scene.select(".xAxis").call(xAxis);scene.select(".yAxis").call(yAxis);bars.xScale(xScale).yScale(yScale).colors(colors);scene.select(".bars").datum(data).call(bars);scene.call(light)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};return my}function chartBubbleChart(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:40,y:40,z:40};var colors=["green","red","yellow","steelblue","orange"];var classed="d3X3domBubbleChart";var debug=false;var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var sizeScale=void 0;var sizeDomain=[.5,3.5];var viewpoint=component.viewpoint();var axis=component.axisThreePlane();var bubbles=component.bubblesMultiSeries();var light=component.light();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),valueExtent=_dataTransform$summar.valueExtent,coordinatesMax=_dataTransform$summar.coordinatesMax,rowKeys=_dataTransform$summar.rowKeys;var maxX=coordinatesMax.x,maxY=coordinatesMax.y,maxZ=coordinatesMax.z;var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scaleLinear().domain([0,maxX]).range([0,dimensionX]);yScale=d3.scaleLinear().domain([0,maxY]).range([0,dimensionY]);zScale=d3.scaleLinear().domain([0,maxZ]).range([0,dimensionZ]);colorScale=d3.scaleOrdinal().domain(rowKeys).range(colors);sizeScale=d3.scaleLinear().domain(valueExtent).range(sizeDomain)};var my=function my(selection){if(!x3d){x3d=selection.append("X3D");scene=x3d.append("Scene")}x3d.attr("width",width+"px").attr("useGeoCache",false).attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","bubbles"];scene.classed(classed,true).selectAll("Group").data(layers).enter().append("Group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]);scene.call(viewpoint);axis.xScale(xScale).yScale(yScale).zScale(zScale);scene.select(".axis").call(axis);bubbles.xScale(xScale).yScale(yScale).zScale(zScale).sizeScale(sizeScale).colorScale(colorScale);scene.select(".bubbles").datum(data).call(bubbles);scene.call(light)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.sizeScale=function(_v){if(!arguments.length)return sizeScale;sizeScale=_v;return my};my.sizeDomain=function(_v){if(!arguments.length)return sizeDomain;sizeDomain=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};return my}function chartCrosshairPlot(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:40,y:40,z:40};var classed="d3X3domCrosshairPlot";var debug=false;var xScale=void 0;var yScale=void 0;var zScale=void 0;var viewpoint=component.viewpoint();var axis=component.axisThreePlane();var crosshair=component.crosshair();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),coordinatesMax=_dataTransform$summar.coordinatesMax;var maxX=coordinatesMax.x,maxY=coordinatesMax.y,maxZ=coordinatesMax.z;var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scaleLinear().domain([0,maxX]).range([0,dimensionX]);yScale=d3.scaleLinear().domain([0,maxY]).range([0,dimensionY]);zScale=d3.scaleLinear().domain([0,maxZ]).range([0,dimensionZ])};var my=function my(selection){if(!x3d){x3d=selection.append("X3D");scene=x3d.append("Scene")}x3d.attr("width",width+"px").attr("useGeoCache",false).attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","crosshairs"];scene.classed(classed,true).selectAll("Group").data(layers).enter().append("Group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]);scene.call(viewpoint);axis.xScale(xScale).yScale(yScale).zScale(zScale).dimensions(dimensions);scene.select(".axis").call(axis);crosshair.xScale(xScale).yScale(yScale).zScale(zScale);var crosshairs=scene.select(".crosshairs").datum(data).selectAll(".crosshair").data(function(d){return d.values});crosshairs.enter().append("group").classed("crosshair",true).merge(crosshairs).transition().each(function(){d3.select(this).call(crosshair)})})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};return my}function chartRibbonChartMultiSeries(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:60,y:40,z:40};var colors=["green","red","yellow","steelblue","orange"];var classed="d3X3domRibbonChartMultiSeries";var debug=false;var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var viewpoint=component.viewpoint();var axis=component.axisThreePlane();var ribbons=component.ribbonMultiSeries();var light=component.light();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scalePoint().domain(columnKeys).range([0,dimensionX]);yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY]).nice();zScale=d3.scaleBand().domain(rowKeys).range([0,dimensionZ]).padding(.4);colorScale=d3.scaleOrdinal().domain(columnKeys).range(colors)};var my=function my(selection){if(!x3d){x3d=selection.append("X3D");scene=x3d.append("Scene")}x3d.attr("width",width+"px").attr("useGeoCache",false).attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","ribbons"];scene.classed(classed,true).selectAll("Group").data(layers).enter().append("Group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]).viewOrientation([-.61021,.77568,.16115,.65629]).viewPosition([77.63865,54.6947,104.38314]);scene.call(viewpoint);axis.xScale(xScale).yScale(yScale).zScale(zScale);scene.select(".axis").call(axis);ribbons.xScale(xScale).yScale(yScale).zScale(zScale).colors(colors).dimensions(dimensions);scene.select(".ribbons").datum(data).call(ribbons);scene.call(light)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};return my}function chartScatterPlot(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:40,y:40,z:40};var color="orange";var classed="d3X3domScatterPlot";var debug=false;var xScale=void 0;var yScale=void 0;var zScale=void 0;var viewpoint=component.viewpoint();var axis=component.axisThreePlane();var crosshair=component.crosshair();var label=component.label();var bubbles=component.bubbles();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),coordinatesMax=_dataTransform$summar.coordinatesMax;var maxX=coordinatesMax.x,maxY=coordinatesMax.y,maxZ=coordinatesMax.z;var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scaleLinear().domain([0,maxX]).range([0,dimensionX]);yScale=d3.scaleLinear().domain([0,maxY]).range([0,dimensionY]);zScale=d3.scaleLinear().domain([0,maxZ]).range([0,dimensionZ])};var my=function my(selection){if(!x3d){x3d=selection.append("X3D");scene=x3d.append("Scene")}x3d.attr("width",width+"px").attr("useGeoCache",false).attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","bubbles","crosshair","label"];scene.classed(classed,true).selectAll("Group").data(layers).enter().append("Group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]);scene.call(viewpoint);axis.xScale(xScale).yScale(yScale).zScale(zScale);scene.select(".axis").call(axis);crosshair.xScale(xScale).yScale(yScale).zScale(zScale);label.xScale(xScale).yScale(yScale).zScale(zScale).offset(.5);bubbles.xScale(xScale).yScale(yScale).zScale(zScale).color(color).sizeDomain([.5,.5]).on("d3X3domClick",function(e){var d=d3.select(e.target).datum();scene.select(".crosshair").datum(d).classed("crosshair",true).each(function(){d3.select(this).call(crosshair)})}).on("d3X3domMouseOver",function(e){var d=d3.select(e.target).datum();scene.select(".label").datum(d).each(function(){d3.select(this).call(label)})}).on("d3X3domMouseOut",function(e){scene.select(".label").selectAll("*").remove()});scene.select(".bubbles").datum(data).call(bubbles)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.color=function(_v){if(!arguments.length)return color;color=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};my.on=function(){var value=dispatch.on.apply(dispatch,arguments);return value===dispatch?my:value};return my}function chartSurfacePlot(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:40,y:40,z:40};var colors=["blue","red"];var classed="d3X3domSurfacePlot";var debug=false;var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var viewpoint=component.viewpoint();var axis=component.axisThreePlane();var surface=component.surface();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scalePoint().domain(rowKeys).range([0,dimensionX]);yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY]).nice();zScale=d3.scalePoint().domain(columnKeys).range([0,dimensionZ]);colorScale=d3.scaleLinear().domain(valueExtent).range(colors).interpolate(d3.interpolateLab)};var my=function my(selection){if(!x3d){x3d=selection.append("X3D");scene=x3d.append("Scene")}x3d.attr("width",width+"px").attr("useGeoCache",false).attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","surface"];scene.classed(classed,true).selectAll("Group").data(layers).enter().append("Group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]);scene.call(viewpoint);axis.xScale(xScale).yScale(yScale).zScale(zScale).labelPosition("distal");scene.select(".axis").call(axis);surface.xScale(xScale).yScale(yScale).zScale(zScale).colors(colors);scene.select(".surface").datum(data).call(surface)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};return my}function chartVectorField(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:40,y:40,z:40};var colors=d3.interpolateRdYlGn;var classed="d3X3domVectorFieldChart";var debug=false;var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var sizeScale=void 0;var sizeDomain=[2,5];var origin={x:0,y:0,z:0};var viewpoint=component.viewpoint();var axis=component.crosshair();var vectorFields=component.vectorFields();var vectorFunction=function vectorFunction(x,y,z){return{vx:x,vy:y,vz:z}};var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),coordinatesMax=_dataTransform$summar.coordinatesMax,coordinatesMin=_dataTransform$summar.coordinatesMin;var minX=coordinatesMin.x,minY=coordinatesMin.y,minZ=coordinatesMin.z;var maxX=coordinatesMax.x,maxY=coordinatesMax.y,maxZ=coordinatesMax.z;var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;var extent=d3.extent(data.values.map(function(f){var vx=void 0,vy=void 0,vz=void 0;if("vx"in f){vx=f.vx;vy=f.vy;vz=f.vz}else{var _vectorFunction=vectorFunction(f.x,f.y,f.z,f.value);vx=_vectorFunction.vx;vy=_vectorFunction.vy;vz=_vectorFunction.vz}return new x3dom.fields.SFVec3f(vx,vy,vz).length()}));xScale=d3.scaleLinear().domain([minX,maxX]).range([0,dimensionX]);yScale=d3.scaleLinear().domain([minY,maxY]).range([0,dimensionY]);zScale=d3.scaleLinear().domain([minZ,maxZ]).range([0,dimensionZ]);colorScale=d3.scaleSequential().domain(extent.slice().reverse()).interpolator(colors);sizeScale=d3.scaleLinear().domain(extent).range(sizeDomain);origin={x:minX<0?0:minX,y:minY<0?0:minY,z:minZ<0?0:minZ}};var my=function my(selection){if(!x3d){x3d=selection.append("X3D");scene=x3d.append("Scene")}x3d.attr("width",width+"px").attr("useGeoCache",false).attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","vectorFields"];scene.classed(classed,true).selectAll("Group").data(layers).enter().append("Group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]);scene.call(viewpoint);axis.xScale(xScale).yScale(yScale).zScale(zScale).dimensions(dimensions);scene.select(".axis").datum(origin).call(axis);vectorFields.xScale(xScale).yScale(yScale).zScale(zScale).colorScale(colorScale).sizeScale(sizeScale).vectorFunction(vectorFunction);scene.select(".vectorFields").datum(data).call(vectorFields)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.sizeScale=function(_v){if(!arguments.length)return sizeScale;sizeScale=_v;return my};my.sizeDomain=function(_v){if(!arguments.length)return sizeDomain;sizeDomain=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};my.vectorFunction=function(_f){if(!arguments.length)return vectorFunction;vectorFunction=_f;return my};return my}function chartVolumeSlice(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:40,y:40,z:40};var classed="d3X3domVolumeSliceChart";var debug=false;var xScale=void 0;var yScale=void 0;var zScale=void 0;var origin={x:0,y:0,z:0};var imageUrl=void 0;var numberOfSlices=void 0;var slicesOverX=void 0;var slicesOverY=void 0;var volumeStyle="OpacityMap";var viewpoint=component.viewpoint();var axis=component.crosshair();var volumeSlice=component.volumeSlice();var my=function my(selection){if(!x3d){x3d=selection.append("X3D");scene=x3d.append("Scene")}x3d.attr("width",width+"px").attr("useGeoCache",false).attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","volume"];scene.classed(classed,true).selectAll("Group").data(layers).enter().append("Group").attr("class",function(d){return d});selection.each(function(data){viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]);scene.call(viewpoint);axis.dimensions(dimensions).xScale(xScale).yScale(yScale).zScale(zScale);scene.select(".axis").datum(origin).call(axis);volumeSlice.dimensions(dimensions).imageUrl(imageUrl).numberOfSlices(numberOfSlices).slicesOverX(slicesOverX).slicesOverY(slicesOverY).volumeStyle(volumeStyle);scene.select(".volume").append("transform").attr("translation",function(){var x=dimensions.x/2;var y=dimensions.y/2;var z=dimensions.z/2;return x+" "+y+" "+z}).datum(function(d){return d}).call(volumeSlice)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.imageUrl=function(_v){if(!arguments.length)return imageUrl;imageUrl=_v;return this};my.numberOfSlices=function(_v){if(!arguments.length)return numberOfSlices;numberOfSlices=_v;return this};my.slicesOverX=function(_v){if(!arguments.length)return slicesOverX;slicesOverX=_v;return this};my.slicesOverY=function(_v){if(!arguments.length)return slicesOverY;slicesOverY=_v;return this};my.volumeStyle=function(_v){if(!arguments.length)return volumeStyle;volumeStyle=_v;return this};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};return my}var chart={areaChartMultiSeries:chartAreaChartMultiSeries,barChartMultiSeries:chartBarChartMultiSeries,barChartVertical:chartBarChartVertical,bubbleChart:chartBubbleChart,crosshairPlot:chartCrosshairPlot,ribbonChartMultiSeries:chartRibbonChartMultiSeries,scatterPlot:chartScatterPlot,surfacePlot:chartSurfacePlot,vectorFieldChart:chartVectorField,volumeSliceChart:chartVolumeSlice};var countries=["UK","France","Spain","Germany","Italy","Portugal"];var fruit=["Apples","Oranges","Pears","Bananas"];function randomNum(){return Math.floor(Math.random()*10)+1}function dataset1(){var data={key:"Fruit",values:fruit.map(function(d){return{key:d,value:randomNum(),x:randomNum(),y:randomNum(),z:randomNum()}})};return data}function dataset2(){var data=countries.map(function(d){return{key:d,values:fruit.map(function(d){return{key:d,value:randomNum(),x:randomNum(),y:randomNum(),z:randomNum()}})}});return data}function dataset3(){var points=arguments.length>0&&arguments[0]!==undefined?arguments[0]:10;var data={key:"Bubbles",values:d3.range(points).map(function(d,i){return{key:"Point"+i,value:randomNum(),x:randomNum(),y:randomNum(),z:randomNum()}})};return data}function dataset4(){var data=[{key:"a",values:[{key:"1",value:4},{key:"2",value:0},{key:"3",value:2},{key:"4",value:0},{key:"5",value:0}]},{key:"b",values:[{key:"1",value:4},{key:"2",value:0},{key:"3",value:2},{key:"4",value:0},{key:"5",value:0}]},{key:"c",values:[{key:"1",value:1},{key:"2",value:0},{key:"3",value:1},{key:"4",value:0},{key:"5",value:0}]},{key:"d",values:[{key:"1",value:4},{key:"2",value:0},{key:"3",value:2},{key:"4",value:0},{key:"5",value:0}]},{key:"e",values:[{key:"1",value:1},{key:"2",value:1},{key:"3",value:1},{key:"4",value:1},{key:"5",value:1}]}];return data}function dataset5(){var cx=.8;var cy=.3;var f=function f(vx,vz){return((vx-cx)*(vx-cx)+(vz-cy)*(vx-cx))*Math.random()};var xRange=d3.range(0,1.05,.1);var zRange=d3.range(0,1.05,.1);var nx=xRange.length;var nz=zRange.length;var data=d3.range(nx).map(function(i){var values=d3.range(nz).map(function(j){return{key:j,value:f(xRange[i],zRange[j])}});return{key:i,values:values}});return data}var randomData=Object.freeze({countries:countries,fruit:fruit,randomNum:randomNum,dataset1:dataset1,dataset2:dataset2,dataset3:dataset3,dataset4:dataset4,dataset5:dataset5});var author="James Saunders";var year=(new Date).getFullYear();var copyright="Copyright (C) "+year+" "+author;var index={version:version,author:author,copyright:copyright,license:license,chart:chart,component:component,dataTransform:dataTransform,randomData:randomData,events:events};return index});
